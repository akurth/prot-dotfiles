#!/bin/bash

# sway_lock --- Use swaylock and set the display to idle
#
# Copyright (c) 2021-2022  Protesilaos Stavrou <info@protesilaos.com>
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.


# FIXME 2021-12-20: I tried variants of this, including with the
# `unlock' command.  Can't make it work properly...

# swayidle \
#     timeout 1 'swaylock -c "004850"' \
#     timeout 5 'swaymsg "output * dpms off"' resume 'swaymsg "output * dpms on"' \
#     after-resume 'pkill -x swayidle'

pgrep -x swayidle > /dev/null && pkill -x swayidle

swayidle \
    timeout 30 'swaymsg "output * dpms off"' \
    resume 'swaymsg "output * dpms on"' &

swaylock -F -e -k -l -c '003f69' --font 'Monospace' --font-size 24 \
         --indicator-idle-visible --indicator-radius 100 \
         --indicator-thickness 20

# Last background job.  Explained in the Job Control section of the Bash
# documentation.  Either check `man bash' or use an Info reader.  For
# Emacs, evaluate: (info "(bash) Job Control")
kill $!
